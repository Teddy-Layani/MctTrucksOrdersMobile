sap.ui.define(["com/meir/meirordersmobile/controller/BaseController","sap/ui/core/routing/History"],function(e,t){"use strict";return e.extend("com.meir.meirordersmobile.controller.MOCreateNewActivity",{onInit:function(){var e=this.getRouter();e.getRoute("MOCreateNewActivity").attachPatternMatched(this._onRouteMatched,this);var t=new sap.ui.model.json.JSONModel([]);this.getOwnerComponent().setModel(t,"newActivitySetting")},_onRouteMatched:function(e){this.getView().getModel("newActivitySetting").setProperty("/",[]);this.getOpportunitySet()},onNavigatePressReturn:function(){var e=t.getInstance();var r=e.getPreviousHash();if(r!==undefined){window.history.go(-1)}else{var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("overview",true)}},selectOpportunity:function(e){var t=this.getOwnerComponent().getModel("moModel");var r=e.getSource().getSelectedContextPaths();var o=t.getProperty(r+"/VechileModel");var i=t.getProperty(r+"/StatusDesc");var n=t.getProperty(r+"/CreateDate");var s=t.getProperty(r+"/ObjectId");var a=t.getProperty(r+"/Guid");this.getView().getModel("newActivitySetting").setProperty("/OppObjectId",s);this.getView().getModel("newActivitySetting").setProperty("/VechileModel",o);this.getView().getModel("newActivitySetting").setProperty("/StatusDesc",i);this.getView().getModel("newActivitySetting").setProperty("/CreateDate",n);this.getView().getModel("newActivitySetting").setProperty("/OppGuid",a)},getOpportunitySet:function(){this.getView().setBusy(true);var e=this.getOwnerComponent().getModel();var t=[];var r=this;var o=this.getOwnerComponent().getModel("moModel").getProperty("/MOCustomers/CustomerObject/Partner");t.push(new sap.ui.model.Filter("Partner","EQ",o));e.read("/OpportunitySet",{filters:t,success:function(e){var t=r.getOwnerComponent().getModel("moModel");t.setProperty("/MOCreateNewActivity/OpportunitySet",e.results);r.getView().setBusy(false)},error:function(e){r.getView().setBusy(false)}})},onPressGoNext:function(){var e=this.getView().getModel("newActivitySetting");var t=this.getOwnerComponent().getModel("moModel").getProperty("/MOCustomers/CustomerObject/NameFirst");var r=this.getOwnerComponent().getModel("moModel").getProperty("/MOCustomers/CustomerObject/NameLast");var o=this.getOwnerComponent().getModel("moModel").getProperty("/MOCustomers/CustomerObject/Partner");var i=e.getData().PostingDate;var n=i.split(".");var s=Number(n[0]);var a=Number(n[1])-1;var g=Number(n[2]);var p=Date.UTC(g,a,s);var u=new Date(p);var l=this.getOwnerComponent().getModel("i18n").getProperty("newCall");var c=l+" "+t+" "+r;e.setProperty("/Description",c);e.setProperty("/Date",u);e.setProperty("/Partner",o);e.setProperty("/NameFirst",t);e.setProperty("/NameLast",r);this.getOwnerComponent().getModel("moModel").setProperty("/MONewActivityDetails/currentActivityDetails",e.getData());this.getRouter().navTo("MONewActivityDetails");this.getView().byId("listOpp").removeSelections(true)}})});